import{_ as C}from"./Bno8S_cx.js";import{b as P,S as U,j as u,G as $,g as j,k as F,l as v,y as s,s as n,B as l,o as O,D as f,W as y,N as R,as as b}from"./vp8MPyNN.js";import{a as x,b as T,c as V}from"./DWH2qXdP.js";import{u as G}from"./ybW-YjLz.js";import{N as M,a as m}from"./DToeYN_d.js";import{N}from"./Bw_fySTz.js";import{N as q}from"./uD4T5QrJ.js";import{N as E}from"./r23Yv2v_.js";import"./CXuCsgek.js";const L={class:"container mx-auto px-4 py-8",dir:"rtl"},W={class:"mb-5 flex items-center justify-between gap-3"},z={class:"pt-2 flex items-center gap-2"},se=P({__name:"[id]",setup(H){const _=U(),i=String(_.params.id),r=G(),p=u(null),e=u({name:"",slug:"",parentID:null,isActive:!0}),g=u([]),d=u(!1),c=u(!1),w={name:{required:!0,message:"نام الزامی است",trigger:"blur"}};$(async()=>{await Promise.all([D(),I()])});async function D(){try{const a=await x(`/categories/${i}`);Object.assign(e.value,a||{})}catch{r.error("خواندن اطلاعات ناموفق بود")}}async function I(){try{const a=await x("categories",{params:{limit:100,offset:0}});g.value=Array.isArray(a?.items)?a.items:[]}catch{}}const k=j(()=>g.value.map(a=>({label:a.name||a.slug||a.id,value:a.id})));async function A(){if(!(!e.value.name||e.value.slug))try{const{slug:a}=await $apiFetch("/utils/slug/preview",{method:"POST",body:{model:"category",source:e.value.name,excludeId:i}});a&&(e.value.slug=a)}catch{}}async function S(){try{await p.value?.validate()}catch{return}d.value=!0;try{await T(`/categories/${i}`,{name:e.value.name,parentID:e.value.parentID||void 0,slug:e.value.slug||void 0,isActive:e.value.isActive}),r.success("ذخیره شد"),b("/admin/categories")}catch(a){r.error(a?.data?.message||"خطا در ذخیره")}finally{d.value=!1}}async function h(){if(confirm("حذف دسته‌بندی؟")){c.value=!0;try{await V(`/categories/${i}`),r.success("حذف شد"),b("/admin/categories")}catch(a){r.error(a?.data?.message||"خطا در حذف")}finally{c.value=!1}}}return(a,t)=>{const B=C;return O(),F("section",L,[v("div",W,[t[5]||(t[5]=v("h1",{class:"text-xl font-bold"},"ویرایش دسته‌بندی",-1)),s(B,{to:"/admin/categories",class:"text-sky-600 hover:underline text-sm"},{default:n(()=>[...t[4]||(t[4]=[f("بازگشت",-1)])]),_:1})]),s(l(R),{class:"rounded-2xl ring-1 ring-slate-200/80 shadow-sm",bordered:!1},{default:n(()=>[s(l(M),{model:e.value,rules:w,ref_key:"formRef",ref:p,"label-placement":"left","label-width":"120"},{default:n(()=>[s(l(m),{label:"نام",path:"name"},{default:n(()=>[s(l(N),{value:e.value.name,"onUpdate:value":t[0]||(t[0]=o=>e.value.name=o),onBlur:A},null,8,["value"])]),_:1}),s(l(m),{label:"اسلاگ",path:"slug"},{default:n(()=>[s(l(N),{value:e.value.slug,"onUpdate:value":t[1]||(t[1]=o=>e.value.slug=o)},null,8,["value"])]),_:1}),s(l(m),{label:"والد",path:"parentID"},{default:n(()=>[s(l(q),{value:e.value.parentID,"onUpdate:value":t[2]||(t[2]=o=>e.value.parentID=o),options:k.value,clearable:""},null,8,["value","options"])]),_:1}),s(l(m),{label:"فعال"},{default:n(()=>[s(l(E),{value:e.value.isActive,"onUpdate:value":t[3]||(t[3]=o=>e.value.isActive=o)},null,8,["value"])]),_:1}),v("div",z,[s(l(y),{type:"primary",loading:d.value,onClick:S},{default:n(()=>[...t[6]||(t[6]=[f("ذخیره",-1)])]),_:1},8,["loading"]),s(l(y),{type:"error",secondary:"",loading:c.value,onClick:h},{default:n(()=>[...t[7]||(t[7]=[f("حذف",-1)])]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1})])}}});export{se as default};
