import{_ as S}from"./Bno8S_cx.js";import{b as B,S as U,j as r,G as A,g as $,k as j,l as f,y as a,s as n,B as l,o as F,D as m,W as b,N as O,as as P}from"./vp8MPyNN.js";import{a as x,b as R,c as V}from"./DWH2qXdP.js";import{u as G}from"./ybW-YjLz.js";import{N as M,a as u}from"./DToeYN_d.js";import{N as d}from"./Bw_fySTz.js";import{N as q}from"./uD4T5QrJ.js";import{N as E}from"./r23Yv2v_.js";import"./CXuCsgek.js";const L={class:"container mx-auto px-4 py-8",dir:"rtl"},W={class:"mb-5 flex items-center justify-between gap-3"},z={class:"pt-2 flex items-center gap-2"},le=B({__name:"[id]",setup(H){const C=U(),i=String(C.params.id),v=G(),g=r(null),e=r({title:"",slug:"",articleTypeID:"",shortContent:"",longContent:"",isActive:!0}),y=r([]),p=r(!1),c=r(!1);A(async()=>{await Promise.all([N(),w()])});async function N(){try{Object.assign(e.value,await x(`/articles/${i}`)||{})}catch{v.error("خواندن مقاله ناموفق بود")}}async function w(){try{y.value=await x("articles/types")}catch{}}const _=$(()=>y.value.map(o=>({label:o.name||o.id,value:o.id}))),h={title:{required:!0,message:"عنوان الزامی است",trigger:"blur"}};async function T(){if(!(!e.value.title||e.value.slug))try{const{slug:o}=await $apiFetch("/utils/slug/preview",{method:"POST",body:{model:"article",source:e.value.title,excludeId:i}});o&&(e.value.slug=o)}catch{}}async function D(){try{await g.value?.validate()}catch{return}p.value=!0;try{await R(`/articles/${i}`,{title:e.value.title,articleTypeID:e.value.articleTypeID||void 0,shortContent:e.value.shortContent||void 0,longContent:e.value.longContent||void 0,slug:e.value.slug||void 0,isActive:e.value.isActive}),v.success("ذخیره شد")}catch(o){v.error(o?.data?.message||"خطا در ذخیره")}finally{p.value=!1}}async function I(){if(confirm("حذف مقاله؟")){c.value=!0;try{await V(`/articles/${i}`),P("/admin/articles")}catch(o){v.error(o?.data?.message||"خطا در حذف")}finally{c.value=!1}}}return(o,t)=>{const k=S;return F(),j("section",L,[f("div",W,[t[7]||(t[7]=f("h1",{class:"text-xl font-bold"},"ویرایش مقاله",-1)),a(k,{to:"/admin/articles",class:"text-sky-600 hover:underline text-sm"},{default:n(()=>[...t[6]||(t[6]=[m("بازگشت",-1)])]),_:1})]),a(l(O),{class:"rounded-2xl ring-1 ring-slate-200/80 shadow-sm",bordered:!1},{default:n(()=>[a(l(M),{model:e.value,rules:h,ref_key:"formRef",ref:g,"label-placement":"left","label-width":"140"},{default:n(()=>[a(l(u),{label:"عنوان",path:"title"},{default:n(()=>[a(l(d),{value:e.value.title,"onUpdate:value":t[0]||(t[0]=s=>e.value.title=s),onBlur:T},null,8,["value"])]),_:1}),a(l(u),{label:"اسلاگ",path:"slug"},{default:n(()=>[a(l(d),{value:e.value.slug,"onUpdate:value":t[1]||(t[1]=s=>e.value.slug=s)},null,8,["value"])]),_:1}),a(l(u),{label:"نوع",path:"articleTypeID"},{default:n(()=>[a(l(q),{value:e.value.articleTypeID,"onUpdate:value":t[2]||(t[2]=s=>e.value.articleTypeID=s),options:_.value,filterable:"",clearable:""},null,8,["value","options"])]),_:1}),a(l(u),{label:"خلاصه",path:"shortContent"},{default:n(()=>[a(l(d),{value:e.value.shortContent,"onUpdate:value":t[3]||(t[3]=s=>e.value.shortContent=s),type:"textarea"},null,8,["value"])]),_:1}),a(l(u),{label:"متن کامل",path:"longContent"},{default:n(()=>[a(l(d),{value:e.value.longContent,"onUpdate:value":t[4]||(t[4]=s=>e.value.longContent=s),type:"textarea"},null,8,["value"])]),_:1}),a(l(u),{label:"فعال"},{default:n(()=>[a(l(E),{value:e.value.isActive,"onUpdate:value":t[5]||(t[5]=s=>e.value.isActive=s)},null,8,["value"])]),_:1}),f("div",z,[a(l(b),{type:"primary",loading:p.value,onClick:D},{default:n(()=>[...t[8]||(t[8]=[m("ذخیره",-1)])]),_:1},8,["loading"]),a(l(b),{type:"error",secondary:"",loading:c.value,onClick:I},{default:n(()=>[...t[9]||(t[9]=[m("حذف",-1)])]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1})])}}});export{le as default};
