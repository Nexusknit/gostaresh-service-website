import{_ as E}from"./Bno8S_cx.js";import{b as L,g as d,S as W,j as n,G as z,k as H,l as f,y as t,q as C,C as A,s as o,B as s,o as b,D as c,W as U,N as D,as as J}from"./vp8MPyNN.js";import{a as B,b as V,c as K}from"./DWH2qXdP.js";import{u as Q}from"./wRpwCGT5.js";import{u as X}from"./ybW-YjLz.js";import{N as Y,a as g}from"./DToeYN_d.js";import{N as x}from"./Bw_fySTz.js";import{N as Z}from"./uD4T5QrJ.js";import"./mYRyJGGe.js";import"./CXuCsgek.js";const ee={class:"container mx-auto px-4 py-8",dir:"rtl"},ae={class:"mb-5 flex items-center justify-between gap-3"},se={class:"pt-2 flex items-center gap-2"},le={class:"space-y-3"},pe=L({__name:"[id]",setup(te){const{hasPerm:p}=Q(),i=d(()=>p("user.update")),S=d(()=>p("user.delete")),y=d(()=>p("user_role.update")),$=d(()=>p("role.read")),h=d(()=>y.value||$.value),j=W(),m=String(j.params.id),u=X(),F=n(null),l=n({firstName:"",lastName:"",userName:"",email:"",isActive:!0}),w=n(!1),_=n(!1),k=n([]),v=n([]),R=n(!1);z(async()=>{await I(),$.value&&await O(),h.value&&await T()});async function I(){try{Object.assign(l.value,await B(`/users/${m}`)||{})}catch{u.error("خواندن اطلاعات کاربر ناموفق بود")}}async function M(){if(i.value){w.value=!0;try{await V(`/users/${m}`,{firstName:l.value.firstName||void 0,lastName:l.value.lastName||void 0,userName:l.value.userName||void 0,email:l.value.email||void 0}),u.success("ذخیره شد")}catch(a){u.error(a?.data?.message||"ذخیره انجام نشد")}finally{w.value=!1}}}async function G(){if(S.value&&confirm("حذف کاربر؟")){_.value=!0;try{await K(`/users/${m}`),u.success("حذف شد"),J("/admin/users")}catch(a){u.error(a?.data?.message||"حذف انجام نشد")}finally{_.value=!1}}}async function O(){try{k.value=await B("/roles")}catch{k.value=[]}}const P=d(()=>k.value.map(a=>({label:a.name||a.id,value:String(a.id)})));async function T(){try{const a=await B(`/users/${m}/roles`),e=Array.isArray(a)?a:Array.isArray(a?.items)?a.items:[];v.value=e.map(N=>String(N?.id??N))}catch{v.value=[]}}async function q(){if(y.value){R.value=!0;try{await V(`/users/${m}/roles`,v.value),u.success("نقش‌ها ذخیره شد")}catch(a){u.error(a?.data?.message||"ذخیره نقش‌ها انجام نشد")}finally{R.value=!1}}}return(a,e)=>{const N=E;return b(),H("section",ee,[f("div",ae,[e[6]||(e[6]=f("h1",{class:"text-xl font-bold"},"ویرایش کاربر",-1)),t(N,{to:"/admin/users",class:"text-sky-600 hover:underline text-sm"},{default:o(()=>[...e[5]||(e[5]=[c("بازگشت",-1)])]),_:1})]),t(s(D),{class:"rounded-2xl ring-1 ring-slate-200/80 shadow-sm mb-6",bordered:!1},{default:o(()=>[t(s(Y),{model:l.value,ref_key:"formRef",ref:F,"label-placement":"left","label-width":"140"},{default:o(()=>[t(s(g),{label:"نام",path:"firstName"},{default:o(()=>[t(s(x),{value:l.value.firstName,"onUpdate:value":e[0]||(e[0]=r=>l.value.firstName=r),disabled:!i.value},null,8,["value","disabled"])]),_:1}),t(s(g),{label:"نام خانوادگی",path:"lastName"},{default:o(()=>[t(s(x),{value:l.value.lastName,"onUpdate:value":e[1]||(e[1]=r=>l.value.lastName=r),disabled:!i.value},null,8,["value","disabled"])]),_:1}),t(s(g),{label:"نام کاربری",path:"userName"},{default:o(()=>[t(s(x),{value:l.value.userName,"onUpdate:value":e[2]||(e[2]=r=>l.value.userName=r),disabled:!i.value},null,8,["value","disabled"])]),_:1}),t(s(g),{label:"ایمیل",path:"email"},{default:o(()=>[t(s(x),{value:l.value.email,"onUpdate:value":e[3]||(e[3]=r=>l.value.email=r),disabled:!i.value},null,8,["value","disabled"])]),_:1}),f("div",se,[i.value?(b(),C(s(U),{key:0,type:"primary",loading:w.value,onClick:M},{default:o(()=>[...e[7]||(e[7]=[c("ذخیره",-1)])]),_:1},8,["loading"])):A("",!0),S.value?(b(),C(s(U),{key:1,type:"error",secondary:"",loading:_.value,onClick:G},{default:o(()=>[...e[8]||(e[8]=[c("حذف",-1)])]),_:1},8,["loading"])):A("",!0)])]),_:1},8,["model"])]),_:1}),h.value?(b(),C(s(D),{key:0,class:"rounded-2xl ring-1 ring-slate-200/80 shadow-sm",bordered:!1},{header:o(()=>[...e[9]||(e[9]=[c("مدیریت نقش‌ها",-1)])]),default:o(()=>[f("div",le,[t(s(Z),{value:v.value,"onUpdate:value":e[4]||(e[4]=r=>v.value=r),options:P.value,disabled:!y.value,multiple:"",filterable:"",placeholder:"انتخاب نقش"},null,8,["value","options","disabled"]),f("div",null,[t(s(U),{type:"primary",loading:R.value,disabled:!y.value,onClick:q},{default:o(()=>[...e[10]||(e[10]=[c(" ذخیره نقش‌ها ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1})):A("",!0)])}}});export{pe as default};
