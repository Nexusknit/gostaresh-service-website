import{_ as B}from"./Bno8S_cx.js";import{a as m,d as x}from"./DWH2qXdP.js";import{b as C,j as n,G as O,g as p,k as F,l as c,y as l,s as r,B as s,o as P,D as A,W as T,N as V,as as j}from"./vp8MPyNN.js";import{u as q}from"./ybW-YjLz.js";import{N as G,a as o}from"./DToeYN_d.js";import{N as v}from"./Bw_fySTz.js";import{N as f}from"./uD4T5QrJ.js";import{N as M}from"./r23Yv2v_.js";import"./CXuCsgek.js";const R={class:"container mx-auto px-4 py-8",dir:"rtl"},E={class:"mb-5 flex items-center justify-between gap-3"},L={class:"pt-2"},ee=C({__name:"create",setup(W){const g=q(),b=n(null),e=n({name:"",slug:"",shortDescription:"",longDescription:"",price:0,brandID:"",categoryID:"",statusID:"",isActive:!0}),d=n(!1),y=n([]),D=n([]),I=n([]);O(async()=>{try{const[a,t,i]=await Promise.all([m("brands",{params:{limit:100,offset:0}}),m("categories",{params:{limit:100,offset:0}}),m("product-statuses")]);y.value=Array.isArray(a?.items)?a.items:[],D.value=Array.isArray(t?.items)?t.items:[],I.value=Array.isArray(i)?i:Array.isArray(i?.items)?i.items:[]}catch{}});const _=p(()=>y.value.map(a=>({label:a.name||a.slug||a.id,value:a.id}))),w=p(()=>D.value.map(a=>({label:a.name||a.slug||a.id,value:a.id}))),U=p(()=>I.value.map(a=>({label:a.name||a.title||a.id||String(a),value:a.id||a.value||String(a)}))),N=p({get:()=>e.value.price?String(e.value.price):"",set:a=>e.value.price=Number(a.replace(/[^\d]/g,""))||0}),S={name:{required:!0,message:"نام الزامی است",trigger:"blur"},price:{required:!0,message:"قیمت الزامی است",trigger:"blur"}};async function h(){if(!(!e.value.name||e.value.slug))try{const{slug:a}=await $apiFetch("/utils/slug/preview",{method:"POST",body:{model:"product",source:e.value.name}});a&&(e.value.slug=a)}catch{}}async function k(){try{await b.value?.validate()}catch{return}d.value=!0;try{await x("products",{name:e.value.name,shortDescription:e.value.shortDescription||void 0,longDescription:e.value.longDescription||void 0,price:e.value.price,statusID:e.value.statusID||void 0,brandID:e.value.brandID||void 0,categoryID:e.value.categoryID||void 0,slug:e.value.slug||void 0,isActive:e.value.isActive}),g.success("محصول افزوده شد"),j("/admin/products")}catch(a){g.error(a?.data?.message||"خطا در ثبت")}finally{d.value=!1}}return(a,t)=>{const i=B;return P(),F("section",R,[c("div",E,[t[10]||(t[10]=c("h1",{class:"text-xl font-bold"},"افزودن محصول",-1)),l(i,{to:"/admin/products",class:"text-sky-600 hover:underline text-sm"},{default:r(()=>[...t[9]||(t[9]=[A("بازگشت",-1)])]),_:1})]),l(s(V),{class:"rounded-2xl ring-1 ring-slate-200/80 shadow-sm",bordered:!1},{default:r(()=>[l(s(G),{model:e.value,rules:S,ref_key:"formRef",ref:b,"label-placement":"left","label-width":"140"},{default:r(()=>[l(s(o),{label:"نام",path:"name"},{default:r(()=>[l(s(v),{value:e.value.name,"onUpdate:value":t[0]||(t[0]=u=>e.value.name=u),onBlur:h},null,8,["value"])]),_:1}),l(s(o),{label:"اسلاگ",path:"slug"},{default:r(()=>[l(s(v),{value:e.value.slug,"onUpdate:value":t[1]||(t[1]=u=>e.value.slug=u)},null,8,["value"])]),_:1}),l(s(o),{label:"خلاصه",path:"shortDescription"},{default:r(()=>[l(s(v),{value:e.value.shortDescription,"onUpdate:value":t[2]||(t[2]=u=>e.value.shortDescription=u),type:"textarea"},null,8,["value"])]),_:1}),l(s(o),{label:"توضیح کامل",path:"longDescription"},{default:r(()=>[l(s(v),{value:e.value.longDescription,"onUpdate:value":t[3]||(t[3]=u=>e.value.longDescription=u),type:"textarea"},null,8,["value"])]),_:1}),l(s(o),{label:"قیمت (تومان)",path:"price"},{default:r(()=>[l(s(v),{value:N.value,"onUpdate:value":t[4]||(t[4]=u=>N.value=u),placeholder:"مثلاً 1200000"},null,8,["value"])]),_:1}),l(s(o),{label:"برند",path:"brandID"},{default:r(()=>[l(s(f),{value:e.value.brandID,"onUpdate:value":t[5]||(t[5]=u=>e.value.brandID=u),options:_.value,filterable:"",clearable:""},null,8,["value","options"])]),_:1}),l(s(o),{label:"دسته‌بندی",path:"categoryID"},{default:r(()=>[l(s(f),{value:e.value.categoryID,"onUpdate:value":t[6]||(t[6]=u=>e.value.categoryID=u),options:w.value,filterable:"",clearable:""},null,8,["value","options"])]),_:1}),l(s(o),{label:"وضعیت",path:"statusID"},{default:r(()=>[l(s(f),{value:e.value.statusID,"onUpdate:value":t[7]||(t[7]=u=>e.value.statusID=u),options:U.value,filterable:"",clearable:""},null,8,["value","options"])]),_:1}),l(s(o),{label:"فعال"},{default:r(()=>[l(s(M),{value:e.value.isActive,"onUpdate:value":t[8]||(t[8]=u=>e.value.isActive=u)},null,8,["value"])]),_:1}),c("div",L,[l(s(T),{type:"primary",loading:d.value,onClick:k},{default:r(()=>[...t[11]||(t[11]=[A("ثبت",-1)])]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1})])}}});export{ee as default};
