import E from"./QLnPFQ3u.js";import{_ as L}from"./Bno8S_cx.js";import{a as A,c as T}from"./DWH2qXdP.js";import{u as U}from"./wRpwCGT5.js";import{b as P,j as l,g as k,H as $,k as G,l as m,y as o,q as H,C as O,B as r,s as u,A as W,h as N,W as b,o as C,D as f,N as F,as as J}from"./vp8MPyNN.js";import{u as K}from"./ybW-YjLz.js";import{N as Q}from"./Bw_fySTz.js";import{N as R}from"./uD4T5QrJ.js";import{N as X}from"./r23Yv2v_.js";import{N as Y}from"./BdE0Vslz.js";import"./mYRyJGGe.js";import"./CXuCsgek.js";import"./DTlRyxep.js";import"./mfReoYN0.js";import"./Bk_rJcZu.js";const Z={class:"container mx-auto px-4 py-8",dir:"rtl"},ee={class:"mb-5 flex items-center justify-between gap-3"},te={class:"flex flex-wrap items-center gap-3"},ae={class:"mt-4 flex items-center justify-between"},se={class:"text-sm text-slate-600"},ne={class:"flex items-center gap-2"},ke=P({__name:"index",setup(le){const{hasPerm:p}=U(),h=K(),v=l(""),c=l(null),g=l(!1),d=l(10),i=l(0),D=l([]),y=l(0),_=l(!1),x=l([]);async function w(){_.value=!0;try{const t=await A("/categories",{params:{q:v.value||void 0,parentID:c.value||void 0,isActive:g.value?!0:void 0,limit:d.value,offset:i.value}}),e=Array.isArray(t?.items)?t.items:[],s=c.value?e:e.filter(a=>!a?.parentID);D.value=s,y.value=typeof t?.total=="number"&&c.value?t.total:s.length}finally{_.value=!1}}async function I(){try{const t=await A("/categories",{params:{limit:100,offset:0}}),e=Array.isArray(t?.items)?t.items:[];x.value=e.filter(s=>!s?.parentID)}catch{x.value=[]}}const S=k(()=>x.value.map(t=>({label:t.name||t.slug||t.id,value:t.id}))),B=k(()=>new Map(x.value.map(t=>[String(t.id),t.name||t.slug||String(t.id)])));function z(){i.value=Math.max(0,i.value-d.value)}function M(){i.value+d.value<y.value&&(i.value+=d.value)}$([v,c,g,d,i],w,{immediate:!0}),I();function V(t){p("category.update")&&J(`/admin/categories/${t.id}`)}async function j(t){if(p("category.delete")&&confirm("حذف دسته‌بندی؟"))try{await T(`/categories/${t.id}`),h.success("حذف شد"),w()}catch(e){h.error(e?.data?.message||"حذف انجام نشد")}}const q=k(()=>{const t=p("category.update"),e=p("category.delete"),s=[{title:"نام",key:"name"},{title:"نامک",key:"slug"},{title:"دسته والد",key:"parentID",render:a=>a?.parent?.name?a.parent.name:a?.parentID?B.value.get(String(a.parentID))||String(a.parentID):"-"},{title:"وضعیت",key:"isActive",render:a=>a.isActive?"فعال":"غیرفعال"}];return(t||e)&&s.push({title:"اقدامات",key:"actions",render(a){const n=[];return t&&n.push(N(b,{size:"small",onClick:()=>V(a)},{default:()=>"ویرایش"})),e&&n.push(N(b,{size:"small",type:"error",secondary:!0,onClick:()=>j(a)},{default:()=>"حذف"})),n.length?N("div",{class:"flex items-center gap-2"},n):null}}),s});return(t,e)=>{const s=E,a=L;return C(),G("section",Z,[m("div",ee,[e[4]||(e[4]=m("h1",{class:"text-xl font-bold"},"دسته‌بندی‌ها",-1)),r(p)("category.create")?(C(),H(a,{key:0,to:"/admin/categories/create",class:"inline-flex items-center gap-2 rounded-xl bg-sky-600 text-white px-3 py-2 text-sm"},{default:u(()=>[o(s,{name:"ph:plus"}),e[3]||(e[3]=f(" افزودن دسته‌بندی ",-1))]),_:1})):O("",!0)]),o(r(F),{class:"rounded-2xl ring-1 ring-slate-200/80 shadow-sm mb-4",bordered:!1},{default:u(()=>[m("div",te,[o(r(Q),{value:v.value,"onUpdate:value":e[0]||(e[0]=n=>v.value=n),placeholder:"جستجو...",class:"w-64",clearable:"",size:"large"},{prefix:u(()=>[o(s,{name:"ph:magnifying-glass-duotone"})]),_:1},8,["value"]),o(r(R),{value:c.value,"onUpdate:value":e[1]||(e[1]=n=>c.value=n),options:S.value,placeholder:"والد",class:"w-64",clearable:""},null,8,["value","options"]),o(r(X),{value:g.value,"onUpdate:value":e[2]||(e[2]=n=>g.value=n)},{checked:u(()=>[...e[5]||(e[5]=[f("فقط فعال",-1)])]),unchecked:u(()=>[...e[6]||(e[6]=[f("همه",-1)])]),_:1},8,["value"])])]),_:1}),o(r(Y),{columns:q.value,data:D.value,loading:_.value,bordered:!1,class:"rounded-2xl ring-1 ring-slate-200 overflow-hidden"},null,8,["columns","data","loading"]),m("div",ae,[m("div",se,"تعداد کل: "+W(y.value),1),m("div",ne,[o(r(b),{size:"small",disabled:i.value===0,onClick:z},{default:u(()=>[...e[7]||(e[7]=[f("قبلی",-1)])]),_:1},8,["disabled"]),o(r(b),{size:"small",disabled:i.value+d.value>=y.value,onClick:M},{default:u(()=>[...e[8]||(e[8]=[f("بعدی",-1)])]),_:1},8,["disabled"])])])])}}});export{ke as default};
