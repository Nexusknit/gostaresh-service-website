import{_ as x}from"./Bno8S_cx.js";import{a as w,d as I}from"./DWH2qXdP.js";import{b as k,j as u,G as A,g as D,k as B,l as m,y as l,s as o,B as s,o as h,D as f,W as S,N as C,as as U}from"./vp8MPyNN.js";import{u as F}from"./ybW-YjLz.js";import{N as T,a as r}from"./DToeYN_d.js";import{N as c}from"./Bw_fySTz.js";import{N as V}from"./uD4T5QrJ.js";import{N as j}from"./r23Yv2v_.js";import"./CXuCsgek.js";const G={class:"container mx-auto px-4 py-8",dir:"rtl"},M={class:"mb-5 flex items-center justify-between gap-3"},O={class:"pt-2"},K=k({__name:"create",setup(P){const d=F(),v=u(null),e=u({name:"",slug:"",parentID:null,isActive:!0}),i=u(!1),p=u([]),g={name:{required:!0,message:"نام الزامی است",trigger:"blur"}};A(async()=>{try{const t=await w("categories",{params:{limit:100,offset:0}});p.value=Array.isArray(t?.items)?t.items:[]}catch{}});const y=D(()=>p.value.map(t=>({label:t.name||t.slug||t.id,value:t.id})));async function b(){if(!(!e.value.name||e.value.slug))try{const{slug:t}=await $apiFetch("/utils/slug/preview",{method:"POST",body:{model:"category",source:e.value.name}});t&&(e.value.slug=t)}catch{}}async function _(){try{await v.value?.validate()}catch{return}i.value=!0;try{await I("categories",{name:e.value.name,parentID:e.value.parentID||void 0,slug:e.value.slug||void 0,isActive:e.value.isActive}),d.success("دسته‌بندی افزوده شد"),U("/admin/categories")}catch(t){d.error(t?.data?.message||"خطا در ثبت")}finally{i.value=!1}}return(t,a)=>{const N=x;return h(),B("section",G,[m("div",M,[a[5]||(a[5]=m("h1",{class:"text-xl font-bold"},"افزودن دسته‌بندی",-1)),l(N,{to:"/admin/categories",class:"text-sky-600 hover:underline text-sm"},{default:o(()=>[...a[4]||(a[4]=[f("بازگشت",-1)])]),_:1})]),l(s(C),{class:"rounded-2xl ring-1 ring-slate-200/80 shadow-sm",bordered:!1},{default:o(()=>[l(s(T),{model:e.value,rules:g,ref_key:"formRef",ref:v,"label-placement":"left","label-width":"120"},{default:o(()=>[l(s(r),{label:"نام",path:"name"},{default:o(()=>[l(s(c),{value:e.value.name,"onUpdate:value":a[0]||(a[0]=n=>e.value.name=n),onBlur:b},null,8,["value"])]),_:1}),l(s(r),{label:"اسلاگ",path:"slug"},{default:o(()=>[l(s(c),{value:e.value.slug,"onUpdate:value":a[1]||(a[1]=n=>e.value.slug=n)},null,8,["value"])]),_:1}),l(s(r),{label:"والد",path:"parentID"},{default:o(()=>[l(s(V),{value:e.value.parentID,"onUpdate:value":a[2]||(a[2]=n=>e.value.parentID=n),options:y.value,clearable:""},null,8,["value","options"])]),_:1}),l(s(r),{label:"فعال"},{default:o(()=>[l(s(j),{value:e.value.isActive,"onUpdate:value":a[3]||(a[3]=n=>e.value.isActive=n)},null,8,["value"])]),_:1}),m("div",O,[l(s(S),{type:"primary",loading:i.value,onClick:_},{default:o(()=>[...a[6]||(a[6]=[f("ثبت",-1)])]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1})])}}});export{K as default};
