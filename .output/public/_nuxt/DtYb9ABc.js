import{_ as R}from"./Bno8S_cx.js";import{b as S,j as i,S as T,E as A,G as I,T as K,q as x,s as t,z as M,o as N,l as o,y as a,B as s,N as U,U as j,V as h,C as D,D as d,A as F,W as L,X as E}from"./vp8MPyNN.js";import{u as G}from"./mYRyJGGe.js";import{N as O,a as b}from"./DToeYN_d.js";import{N as k}from"./Bw_fySTz.js";import{N as W}from"./VBYp0bj-.js";const X={class:"min-h-[70dvh] flex items-center justify-center px-4",dir:"rtl"},H=["onKeydown"],J={class:"text-center text-xs text-slate-500"},ae=S({__name:"login",setup(P){const m=K(),v=T(),p=i(typeof v.query.redirect=="string"?v.query.redirect:"/admin"),{token:f,isLoggedIn:y,user:w,login:C,fetchMe:q}=G(),g=i(null),r=A({userName:"",password:""}),l=i(!1),n=i(null),B={userName:[{required:!0,message:"نام کاربری الزامی است",trigger:["blur","input"]}],password:[{required:!0,message:"رمز عبور الزامی است",trigger:["blur","input"]}]};I(async()=>{if(y.value&&w.value){m.replace(p.value||"/admin");return}if(f.value){l.value=!0;try{await q(f.value),y.value&&(w.value||f.value)&&m.replace(p.value||"/admin")}catch{}finally{l.value=!1}}});async function _(){if(!l.value){n.value=null;try{await g.value?.validate()}catch{return}l.value=!0;try{await C({userName:r.userName,password:r.password}),await E(),m.replace(p.value||"/admin")}catch(u){n.value=u?.data?.message||u?.message||"ورود ناموفق بود"}finally{l.value=!1}}}return(u,e)=>{const V=R,z=M;return N(),x(z,null,{default:t(()=>[o("section",X,[a(s(U),{class:"w-full max-w-md rounded-2xl ring-1 ring-slate-200/80 shadow-sm"},{header:t(()=>[...e[2]||(e[2]=[o("div",{class:"text-center w-full space-y-1"},[o("h1",{class:"text-lg font-bold"},"ورود به حساب کاربری"),o("p",{class:"text-slate-500 text-xs mt-1"}," لطفاً نام کاربری و رمز عبور خود را وارد کنید تا به پنل مدیریت دسترسی پیدا کنید. ")],-1)])]),footer:t(()=>[o("div",J,[e[5]||(e[5]=d(" بازگشت به ",-1)),a(V,{to:"/",class:"text-sky-600 hover:underline"},{default:t(()=>[...e[4]||(e[4]=[d("صفحه اصلی",-1)])]),_:1})])]),default:t(()=>[o("form",{class:"space-y-4",onSubmit:h(_,["prevent"]),onKeydown:j(h(_,["prevent"]),["enter"])},[a(s(O),{model:r,rules:B,disabled:l.value,ref_key:"formRef",ref:g},{default:t(()=>[a(s(b),{path:"userName",label:"نام کاربری"},{default:t(()=>[a(s(k),{value:r.userName,"onUpdate:value":e[0]||(e[0]=c=>r.userName=c),placeholder:"admin",size:"large"},null,8,["value"])]),_:1}),a(s(b),{path:"password",label:"رمز عبور"},{default:t(()=>[a(s(k),{value:r.password,"onUpdate:value":e[1]||(e[1]=c=>r.password=c),type:"password","show-password-on":"mousedown",placeholder:"********",size:"large"},null,8,["value"])]),_:1})]),_:1},8,["model","disabled"]),n.value?(N(),x(s(W),{key:0,type:"error",class:"text-right"},{default:t(()=>[d(F(n.value),1)]),_:1})):D("",!0),a(s(L),{type:"primary",size:"large",class:"w-full",loading:l.value,"attr-type":"submit"},{default:t(()=>[...e[3]||(e[3]=[d(" ورود ",-1)])]),_:1},8,["loading"])],40,H)]),_:1})])]),_:1})}}});export{ae as default};
