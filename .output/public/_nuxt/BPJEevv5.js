import{_ as O}from"./Bno8S_cx.js";import{b as T,g as r,S as L,j as o,G as W,k as z,l as m,y as n,q as k,C as P,s,B as t,o as y,D as c,W as h,N as I,as as H}from"./vp8MPyNN.js";import{a as C,b as R,c as J}from"./DWH2qXdP.js";import{u as K}from"./wRpwCGT5.js";import{u as Q}from"./ybW-YjLz.js";import{N as X,a as Y}from"./DToeYN_d.js";import{N as Z}from"./Bw_fySTz.js";import{N as ee}from"./uD4T5QrJ.js";import"./mYRyJGGe.js";import"./CXuCsgek.js";const ae={class:"container mx-auto px-4 py-8",dir:"rtl"},se={class:"mb-5 flex items-center justify-between gap-3"},te={class:"pt-2 flex items-center gap-2"},le={class:"space-y-3"},ye=T({__name:"[id]",setup(oe){const{hasPerm:f}=K(),g=r(()=>f("role.update")),B=r(()=>f("role.delete")),p=r(()=>f("role_permission.update")),S=r(()=>f("permission.read")),D=r(()=>p.value||S.value),V=L(),i=String(V.params.id),l=Q(),$=o(null),u=o({name:""}),j={name:{required:!0,message:"نام الزامی است",trigger:"blur"}},b=o(!1),_=o(!1),w=o([]),d=o([]),x=o(!1);W(async()=>{await A(),S.value&&await U(),D.value&&await E()});async function A(){try{Object.assign(u.value,await C(`/roles/${i}`)||{})}catch{l.error("خواندن نقش ناموفق بود")}}async function F(){if(g.value){try{await $.value?.validate()}catch{return}b.value=!0;try{await R(`/roles/${i}`,{name:u.value.name}),l.success("ذخیره شد")}catch(a){l.error(a?.data?.message||"ذخیره انجام نشد")}finally{b.value=!1}}}async function M(){if(B.value&&confirm("حذف نقش؟")){_.value=!0;try{await J(`/roles/${i}`),l.success("حذف شد"),H("/admin/roles")}catch(a){l.error(a?.data?.message||"حذف انجام نشد")}finally{_.value=!1}}}async function U(){try{w.value=await C("/permissions")}catch{w.value=[]}}const q=r(()=>w.value.map(a=>({label:a.name||a.id,value:String(a.id)})));async function E(){try{const a=await C(`/roles/${i}`),e=Array.isArray(a?.permissions)?a.permissions:[];d.value=e.map(v=>String(v?.id??v))}catch{d.value=[]}}async function G(){if(p.value){x.value=!0;try{await R(`/roles/${i}/permissions`,{permissionIDs:d.value}),l.success("مجوزها ذخیره شد")}catch(a){l.error(a?.data?.message||"ذخیره مجوزها انجام نشد")}finally{x.value=!1}}}return(a,e)=>{const v=O;return y(),z("section",ae,[m("div",se,[e[3]||(e[3]=m("h1",{class:"text-xl font-bold"},"ویرایش نقش",-1)),n(v,{to:"/admin/roles",class:"text-sky-600 hover:underline text-sm"},{default:s(()=>[...e[2]||(e[2]=[c("بازگشت",-1)])]),_:1})]),n(t(I),{class:"rounded-2xl ring-1 ring-slate-200/80 shadow-sm mb-6",bordered:!1},{default:s(()=>[n(t(X),{model:u.value,rules:j,ref_key:"formRef",ref:$,"label-placement":"left","label-width":"140"},{default:s(()=>[n(t(Y),{label:"نام",path:"name"},{default:s(()=>[n(t(Z),{value:u.value.name,"onUpdate:value":e[0]||(e[0]=N=>u.value.name=N),disabled:!g.value},null,8,["value","disabled"])]),_:1}),m("div",te,[g.value?(y(),k(t(h),{key:0,type:"primary",loading:b.value,onClick:F},{default:s(()=>[...e[4]||(e[4]=[c("ذخیره",-1)])]),_:1},8,["loading"])):P("",!0),B.value?(y(),k(t(h),{key:1,type:"error",secondary:"",loading:_.value,onClick:M},{default:s(()=>[...e[5]||(e[5]=[c("حذف",-1)])]),_:1},8,["loading"])):P("",!0)])]),_:1},8,["model"])]),_:1}),D.value?(y(),k(t(I),{key:0,class:"rounded-2xl ring-1 ring-slate-200/80 shadow-sm",bordered:!1},{header:s(()=>[...e[6]||(e[6]=[c("مجوزهای نقش",-1)])]),default:s(()=>[m("div",le,[n(t(ee),{value:d.value,"onUpdate:value":e[1]||(e[1]=N=>d.value=N),options:q.value,disabled:!p.value,multiple:"",filterable:"",placeholder:"انتخاب مجوز"},null,8,["value","options","disabled"]),m("div",null,[n(t(h),{type:"primary",loading:x.value,disabled:!p.value,onClick:G},{default:s(()=>[...e[7]||(e[7]=[c(" ذخیره مجوزها ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1})):P("",!0)])}}});export{ye as default};
