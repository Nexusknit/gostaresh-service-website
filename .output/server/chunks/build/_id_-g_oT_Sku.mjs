import{_ as e}from"./nuxt-link-DlD_4d-2.mjs";import{defineComponent as a,computed as l,ref as u,mergeProps as t,withCtx as s,createTextVNode as r,unref as i,createVNode as d,createBlock as o,createCommentVNode as v,openBlock as n,useSSRContext as m}from"vue";import{ssrRenderAttrs as p,ssrRenderComponent as f}from"vue/server-renderer";import{useRoute as c}from"vue-router";import{a as b,b as N}from"./api-qvnChiK5.mjs";import{u as y}from"./useAccess-BGBQvVbm.mjs";import{N as _,C as h,F as g}from"./server.mjs";import{u as U}from"./use-message-DH0YWJK4.mjs";import{N as x,a as k}from"./FormItem-Ds_MAETL.mjs";import{N as j}from"./Input-DBNoyZOz.mjs";import{N as C}from"./Select-C0U9uRTf.mjs";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:url";import"@iconify/utils";import"node:crypto";import"consola";import"node:path";import"./useAuth-BCA76F4T.mjs";import"pinia";import"@iconify/vue";import"@css-render/vue3-ssr";import"seemly";import"@css-render/plugin-bem";import"css-render";import"lodash-es";import"evtd";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/plugins";import"unhead/utils";import"async-validator";import"date-fns/locale";import"treemate";import"./Tag-BJGgCXYj.mjs";import"@juggle/resize-observer";const w=a({__name:"[id]",__ssrInlineRender:!0,setup(a){const{hasPerm:m}=y(),w=l(()=>m("user.update")),D=l(()=>m("user.delete")),S=l(()=>m("user_role.update")),R=l(()=>m("role.read")),$=l(()=>S.value||R.value),A=c(),B=String(A.params.id),T=U(),F=u(null),I=u({firstName:"",lastName:"",userName:"",email:"",isActive:!0}),z=u(!1),G=u(!1),J=u([]),K=u([]),Y=u(!1);async function onSubmit(){if(w.value){z.value=!0;try{await b(`/users/${B}`,{firstName:I.value.firstName||void 0,lastName:I.value.lastName||void 0,userName:I.value.userName||void 0,email:I.value.email||void 0}),T.success("ذخیره شد")}catch(e){T.error(e?.data?.message||"ذخیره انجام نشد")}finally{z.value=!1}}}async function onDelete(){if(D.value&&confirm("حذف کاربر؟")){G.value=!0;try{await N(`/users/${B}`),T.success("حذف شد"),g("/admin/users")}catch(e){T.error(e?.data?.message||"حذف انجام نشد")}finally{G.value=!1}}}const q=l(()=>J.value.map(e=>({label:e.name||e.id,value:String(e.id)})));async function saveRoles(){if(S.value){Y.value=!0;try{await b(`/users/${B}/roles`,K.value),T.success("نقش‌ها ذخیره شد")}catch(e){T.error(e?.data?.message||"ذخیره نقش‌ها انجام نشد")}finally{Y.value=!1}}}return(a,l,u,m)=>{const c=e;l(`<section${p(t({class:"container mx-auto px-4 py-8",dir:"rtl"},m))}><div class="mb-5 flex items-center justify-between gap-3"><h1 class="text-xl font-bold">ویرایش کاربر</h1>`),l(f(c,{to:"/admin/users",class:"text-sky-600 hover:underline text-sm"},{default:s((e,a,l,u)=>{if(!a)return[r("بازگشت")];a("بازگشت")}),_:1},u)),l("</div>"),l(f(i(_),{class:"rounded-2xl ring-1 ring-slate-200/80 shadow-sm mb-6",bordered:!1},{default:s((e,a,l,u)=>{if(!a)return[d(i(x),{model:I.value,ref_key:"formRef",ref:F,"label-placement":"left","label-width":"140"},{default:s(()=>[d(i(k),{label:"نام",path:"firstName"},{default:s(()=>[d(i(j),{value:I.value.firstName,"onUpdate:value":e=>I.value.firstName=e,disabled:!w.value},null,8,["value","onUpdate:value","disabled"])]),_:1}),d(i(k),{label:"نام خانوادگی",path:"lastName"},{default:s(()=>[d(i(j),{value:I.value.lastName,"onUpdate:value":e=>I.value.lastName=e,disabled:!w.value},null,8,["value","onUpdate:value","disabled"])]),_:1}),d(i(k),{label:"نام کاربری",path:"userName"},{default:s(()=>[d(i(j),{value:I.value.userName,"onUpdate:value":e=>I.value.userName=e,disabled:!w.value},null,8,["value","onUpdate:value","disabled"])]),_:1}),d(i(k),{label:"ایمیل",path:"email"},{default:s(()=>[d(i(j),{value:I.value.email,"onUpdate:value":e=>I.value.email=e,disabled:!w.value},null,8,["value","onUpdate:value","disabled"])]),_:1}),d("div",{class:"pt-2 flex items-center gap-2"},[w.value?(n(),o(i(h),{key:0,type:"primary",loading:z.value,onClick:onSubmit},{default:s(()=>[r("ذخیره")]),_:1},8,["loading"])):v("",!0),D.value?(n(),o(i(h),{key:1,type:"error",secondary:"",loading:G.value,onClick:onDelete},{default:s(()=>[r("حذف")]),_:1},8,["loading"])):v("",!0)])]),_:1},8,["model"])];a(f(i(x),{model:I.value,ref_key:"formRef",ref:F,"label-placement":"left","label-width":"140"},{default:s((e,a,l,u)=>{if(!a)return[d(i(k),{label:"نام",path:"firstName"},{default:s(()=>[d(i(j),{value:I.value.firstName,"onUpdate:value":e=>I.value.firstName=e,disabled:!w.value},null,8,["value","onUpdate:value","disabled"])]),_:1}),d(i(k),{label:"نام خانوادگی",path:"lastName"},{default:s(()=>[d(i(j),{value:I.value.lastName,"onUpdate:value":e=>I.value.lastName=e,disabled:!w.value},null,8,["value","onUpdate:value","disabled"])]),_:1}),d(i(k),{label:"نام کاربری",path:"userName"},{default:s(()=>[d(i(j),{value:I.value.userName,"onUpdate:value":e=>I.value.userName=e,disabled:!w.value},null,8,["value","onUpdate:value","disabled"])]),_:1}),d(i(k),{label:"ایمیل",path:"email"},{default:s(()=>[d(i(j),{value:I.value.email,"onUpdate:value":e=>I.value.email=e,disabled:!w.value},null,8,["value","onUpdate:value","disabled"])]),_:1}),d("div",{class:"pt-2 flex items-center gap-2"},[w.value?(n(),o(i(h),{key:0,type:"primary",loading:z.value,onClick:onSubmit},{default:s(()=>[r("ذخیره")]),_:1},8,["loading"])):v("",!0),D.value?(n(),o(i(h),{key:1,type:"error",secondary:"",loading:G.value,onClick:onDelete},{default:s(()=>[r("حذف")]),_:1},8,["loading"])):v("",!0)])];a(f(i(k),{label:"نام",path:"firstName"},{default:s((e,a,l,u)=>{if(!a)return[d(i(j),{value:I.value.firstName,"onUpdate:value":e=>I.value.firstName=e,disabled:!w.value},null,8,["value","onUpdate:value","disabled"])];a(f(i(j),{value:I.value.firstName,"onUpdate:value":e=>I.value.firstName=e,disabled:!w.value},null,l,u))}),_:1},l,u)),a(f(i(k),{label:"نام خانوادگی",path:"lastName"},{default:s((e,a,l,u)=>{if(!a)return[d(i(j),{value:I.value.lastName,"onUpdate:value":e=>I.value.lastName=e,disabled:!w.value},null,8,["value","onUpdate:value","disabled"])];a(f(i(j),{value:I.value.lastName,"onUpdate:value":e=>I.value.lastName=e,disabled:!w.value},null,l,u))}),_:1},l,u)),a(f(i(k),{label:"نام کاربری",path:"userName"},{default:s((e,a,l,u)=>{if(!a)return[d(i(j),{value:I.value.userName,"onUpdate:value":e=>I.value.userName=e,disabled:!w.value},null,8,["value","onUpdate:value","disabled"])];a(f(i(j),{value:I.value.userName,"onUpdate:value":e=>I.value.userName=e,disabled:!w.value},null,l,u))}),_:1},l,u)),a(f(i(k),{label:"ایمیل",path:"email"},{default:s((e,a,l,u)=>{if(!a)return[d(i(j),{value:I.value.email,"onUpdate:value":e=>I.value.email=e,disabled:!w.value},null,8,["value","onUpdate:value","disabled"])];a(f(i(j),{value:I.value.email,"onUpdate:value":e=>I.value.email=e,disabled:!w.value},null,l,u))}),_:1},l,u)),a(`<div class="pt-2 flex items-center gap-2"${u}>`),w.value?a(f(i(h),{type:"primary",loading:z.value,onClick:onSubmit},{default:s((e,a,l,u)=>{if(!a)return[r("ذخیره")];a("ذخیره")}),_:1},l,u)):a("\x3c!----\x3e"),D.value?a(f(i(h),{type:"error",secondary:"",loading:G.value,onClick:onDelete},{default:s((e,a,l,u)=>{if(!a)return[r("حذف")];a("حذف")}),_:1},l,u)):a("\x3c!----\x3e"),a("</div>")}),_:1},l,u))}),_:1},u)),$.value?l(f(i(_),{class:"rounded-2xl ring-1 ring-slate-200/80 shadow-sm",bordered:!1},{header:s((e,a,l,u)=>{if(!a)return[r("مدیریت نقش‌ها")];a("مدیریت نقش‌ها")}),default:s((e,a,l,u)=>{if(!a)return[d("div",{class:"space-y-3"},[d(i(C),{value:K.value,"onUpdate:value":e=>K.value=e,options:q.value,disabled:!S.value,multiple:"",filterable:"",placeholder:"انتخاب نقش"},null,8,["value","onUpdate:value","options","disabled"]),d("div",null,[d(i(h),{type:"primary",loading:Y.value,disabled:!S.value,onClick:saveRoles},{default:s(()=>[r(" ذخیره نقش‌ها ")]),_:1},8,["loading","disabled"])])])];a(`<div class="space-y-3"${u}>`),a(f(i(C),{value:K.value,"onUpdate:value":e=>K.value=e,options:q.value,disabled:!S.value,multiple:"",filterable:"",placeholder:"انتخاب نقش"},null,l,u)),a(`<div${u}>`),a(f(i(h),{type:"primary",loading:Y.value,disabled:!S.value,onClick:saveRoles},{default:s((e,a,l,u)=>{if(!a)return[r(" ذخیره نقش‌ها ")];a(" ذخیره نقش‌ها ")}),_:1},l,u)),a("</div></div>")}),_:1},u)):l("\x3c!----\x3e"),l("</section>")}}}),D=w.setup;w.setup=(e,a)=>{const l=m();return(l.modules||(l.modules=new Set)).add("pages/admin/users/[id].vue"),D?D(e,a):void 0};export{w as default};
//# sourceMappingURL=_id_-g_oT_Sku.mjs.map
