import{_ as e}from"./nuxt-link-DlD_4d-2.mjs";import t from"./index-AgLHWp8z.mjs";import{defineComponent as s,ref as r,computed as i,watch as a,h as l,mergeProps as o,withCtx as m,createVNode as n,createTextVNode as u,unref as p,useSSRContext as d}from"vue";import{ssrRenderAttrs as c,ssrRenderComponent as v,ssrInterpolate as f}from"vue/server-renderer";import{c as h,b as y}from"./api-qvnChiK5.mjs";import{u as x}from"./useAccess-BGBQvVbm.mjs";import{C as g,F as j}from"./server.mjs";import{u as b}from"./use-message-DH0YWJK4.mjs";import{N as k}from"./DataTable-BeR9LhSC.mjs";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:url";import"@iconify/utils";import"node:crypto";import"consola";import"node:path";import"@iconify/vue";import"@iconify/utils/lib/css/icon";import"./useAuth-BCA76F4T.mjs";import"pinia";import"vue-router";import"@css-render/vue3-ssr";import"seemly";import"@css-render/plugin-bem";import"css-render";import"lodash-es";import"evtd";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/plugins";import"unhead/utils";import"./Input-DBNoyZOz.mjs";import"date-fns/locale";import"./Checkbox-uGza85BZ.mjs";import"./Ellipsis-DDM1ZdJ1.mjs";import"./Select-C0U9uRTf.mjs";import"treemate";import"./Tag-BJGgCXYj.mjs";import"@juggle/resize-observer";import"./get-slot-BIpdyb5h.mjs";const C=s({__name:"index",__ssrInlineRender:!0,setup(s){const{hasPerm:d}=x(),C=b(),_=r(10),z=r(0),A=r([]),B=r(0),w=r(!1),D=i(()=>d("user.create")),L=i(()=>d("user.update")),N=i(()=>d("user.delete"));async function fetchList(){w.value=!0;try{const e=await h("/users",{params:{limit:_.value,offset:z.value}});A.value=Array.isArray(e?.items)?e.items:[],B.value="number"==typeof e?.total?e.total:A.value.length}finally{w.value=!1}}function prev(){z.value=Math.max(0,z.value-_.value)}function next(){z.value+_.value<B.value&&(z.value+=_.value)}a([_,z],fetchList,{immediate:!0});const T=i(()=>{const e=[{title:"نام",key:"firstName"},{title:"نام خانوادگی",key:"lastName"},{title:"نام کاربری",key:"userName"},{title:"ایمیل",key:"email"},{title:"وضعیت",key:"isActive",render:e=>e.isActive?"فعال":"غیرفعال"}];return(L.value||N.value)&&e.push({title:"اقدامات",key:"actions",render(e){const t=[];return L.value&&t.push(l(g,{size:"small",onClick:()=>function(e){L.value&&j(`/admin/users/${e.id}`)}(e)},{default:()=>"ویرایش"})),N.value&&t.push(l(g,{size:"small",type:"error",secondary:!0,onClick:()=>async function(e){if(N.value&&confirm("حذف کاربر؟"))try{await y(`/users/${e.id}`),C.success("حذف شد"),fetchList()}catch(e){C.error(e?.data?.message||"حذف انجام نشد")}}(e)},{default:()=>"حذف"})),t.length?l("div",{class:"flex items-center gap-2"},t):null}}),e});return(s,r,i,a)=>{const l=e,d=t;r(`<section${c(o({class:"container mx-auto px-4 py-8",dir:"rtl"},a))}><div class="mb-5 flex items-center justify-between gap-3"><h1 class="text-xl font-bold">کاربران</h1>`),D.value?r(v(l,{to:"/admin/users/create",class:"inline-flex items-center gap-2 rounded-xl bg-sky-600 text-white px-3 py-2 text-sm"},{default:m((e,t,s,r)=>{if(!t)return[n(d,{name:"ph:plus"}),u(" افزودن کاربر ")];t(v(d,{name:"ph:plus"},null,s,r)),t(" افزودن کاربر ")}),_:1},i)):r("\x3c!----\x3e"),r("</div>"),r(v(p(k),{columns:T.value,data:A.value,loading:w.value,bordered:!1,class:"rounded-2xl ring-1 ring-slate-200 overflow-hidden"},null,i)),r(`<div class="mt-4 flex items-center justify-between"><div class="text-sm text-slate-600">تعداد کل: ${f(B.value)}</div><div class="flex items-center gap-2">`),r(v(p(g),{size:"small",disabled:0===z.value,onClick:prev},{default:m((e,t,s,r)=>{if(!t)return[u("قبلی")];t("قبلی")}),_:1},i)),r(v(p(g),{size:"small",disabled:z.value+_.value>=B.value,onClick:next},{default:m((e,t,s,r)=>{if(!t)return[u("بعدی")];t("بعدی")}),_:1},i)),r("</div></div></section>")}}}),_=C.setup;C.setup=(e,t)=>{const s=d();return(s.modules||(s.modules=new Set)).add("pages/admin/users/index.vue"),_?_(e,t):void 0};export{C as default};
//# sourceMappingURL=index-DyNa7iOa.mjs.map
