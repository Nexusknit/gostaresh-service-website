import{_ as e}from"./nuxt-link-DlD_4d-2.mjs";import t from"./index-AgLHWp8z.mjs";import{defineComponent as a,ref as r,computed as l,watch as i,h as s,mergeProps as n,unref as o,withCtx as u,createVNode as m,createTextVNode as p,useSSRContext as d}from"vue";import{ssrRenderAttrs as c,ssrRenderComponent as v,ssrInterpolate as f}from"vue/server-renderer";import{c as g,b as h}from"./api-qvnChiK5.mjs";import{u as y}from"./useAccess-BGBQvVbm.mjs";import{C as x,N as b,F as j}from"./server.mjs";import{u as w}from"./use-message-DH0YWJK4.mjs";import{N as k}from"./Input-DBNoyZOz.mjs";import{N as D}from"./Select-C0U9uRTf.mjs";import{N as _}from"./Switch-DTUH-ntq.mjs";import{N as A}from"./DataTable-BeR9LhSC.mjs";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:url";import"@iconify/utils";import"node:crypto";import"consola";import"node:path";import"@iconify/vue";import"@iconify/utils/lib/css/icon";import"pinia";import"vue-router";import"@css-render/vue3-ssr";import"seemly";import"@css-render/plugin-bem";import"css-render";import"lodash-es";import"evtd";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/plugins";import"unhead/utils";import"./useAuth-BCA76F4T.mjs";import"date-fns/locale";import"treemate";import"./Tag-BJGgCXYj.mjs";import"@juggle/resize-observer";import"./Checkbox-uGza85BZ.mjs";import"./Ellipsis-DDM1ZdJ1.mjs";import"./get-slot-BIpdyb5h.mjs";const C=a({__name:"index",__ssrInlineRender:!0,setup(a){const{hasPerm:d}=y(),C=w(),U=r(""),z=r(null),I=r(!1),B=r(10),S=r(0),N=r([]),L=r(0),T=r(!1),$=r([]);async function fetchList(){T.value=!0;try{const e=await g("/categories",{params:{q:U.value||void 0,parentID:z.value||void 0,isActive:!!I.value||void 0,limit:B.value,offset:S.value}}),t=Array.isArray(e?.items)?e.items:[],a=z.value?t:t.filter(e=>!e?.parentID);N.value=a,L.value="number"==typeof e?.total&&z.value?e.total:a.length}finally{T.value=!1}}const q=l(()=>$.value.map(e=>({label:e.name||e.slug||e.id,value:e.id}))),G=l(()=>new Map($.value.map(e=>[String(e.id),e.name||e.slug||String(e.id)])));function prev(){S.value=Math.max(0,S.value-B.value)}function next(){S.value+B.value<L.value&&(S.value+=B.value)}i([U,z,I,B,S],fetchList,{immediate:!0}),async function(){try{const e=await g("/categories",{params:{limit:100,offset:0}}),t=Array.isArray(e?.items)?e.items:[];$.value=t.filter(e=>!e?.parentID)}catch{$.value=[]}}();const H=l(()=>{const e=d("category.update"),t=d("category.delete"),a=[{title:"نام",key:"name"},{title:"نامک",key:"slug"},{title:"دسته والد",key:"parentID",render:e=>e?.parent?.name?e.parent.name:e?.parentID?G.value.get(String(e.parentID))||String(e.parentID):"-"},{title:"وضعیت",key:"isActive",render:e=>e.isActive?"فعال":"غیرفعال"}];return(e||t)&&a.push({title:"اقدامات",key:"actions",render(a){const r=[];return e&&r.push(s(x,{size:"small",onClick:()=>function(e){d("category.update")&&j(`/admin/categories/${e.id}`)}(a)},{default:()=>"ویرایش"})),t&&r.push(s(x,{size:"small",type:"error",secondary:!0,onClick:()=>async function(e){if(d("category.delete")&&confirm("حذف دسته‌بندی؟"))try{await h(`/categories/${e.id}`),C.success("حذف شد"),fetchList()}catch(e){C.error(e?.data?.message||"حذف انجام نشد")}}(a)},{default:()=>"حذف"})),r.length?s("div",{class:"flex items-center gap-2"},r):null}}),a});return(a,r,l,i)=>{const s=e,g=t;r(`<section${c(n({class:"container mx-auto px-4 py-8",dir:"rtl"},i))}><div class="mb-5 flex items-center justify-between gap-3"><h1 class="text-xl font-bold">دسته‌بندی‌ها</h1>`),o(d)("category.create")?r(v(s,{to:"/admin/categories/create",class:"inline-flex items-center gap-2 rounded-xl bg-sky-600 text-white px-3 py-2 text-sm"},{default:u((e,t,a,r)=>{if(!t)return[m(g,{name:"ph:plus"}),p(" افزودن دسته‌بندی ")];t(v(g,{name:"ph:plus"},null,a,r)),t(" افزودن دسته‌بندی ")}),_:1},l)):r("\x3c!----\x3e"),r("</div>"),r(v(o(b),{class:"rounded-2xl ring-1 ring-slate-200/80 shadow-sm mb-4",bordered:!1},{default:u((e,t,a,r)=>{if(!t)return[m("div",{class:"flex flex-wrap items-center gap-3"},[m(o(k),{value:U.value,"onUpdate:value":e=>U.value=e,placeholder:"جستجو...",class:"w-64",clearable:"",size:"large"},{prefix:u(()=>[m(g,{name:"ph:magnifying-glass-duotone"})]),_:1},8,["value","onUpdate:value"]),m(o(D),{value:z.value,"onUpdate:value":e=>z.value=e,options:q.value,placeholder:"والد",class:"w-64",clearable:""},null,8,["value","onUpdate:value","options"]),m(o(_),{value:I.value,"onUpdate:value":e=>I.value=e},{checked:u(()=>[p("فقط فعال")]),unchecked:u(()=>[p("همه")]),_:1},8,["value","onUpdate:value"])])];t(`<div class="flex flex-wrap items-center gap-3"${r}>`),t(v(o(k),{value:U.value,"onUpdate:value":e=>U.value=e,placeholder:"جستجو...",class:"w-64",clearable:"",size:"large"},{prefix:u((e,t,a,r)=>{if(!t)return[m(g,{name:"ph:magnifying-glass-duotone"})];t(v(g,{name:"ph:magnifying-glass-duotone"},null,a,r))}),_:1},a,r)),t(v(o(D),{value:z.value,"onUpdate:value":e=>z.value=e,options:q.value,placeholder:"والد",class:"w-64",clearable:""},null,a,r)),t(v(o(_),{value:I.value,"onUpdate:value":e=>I.value=e},{checked:u((e,t,a,r)=>{if(!t)return[p("فقط فعال")];t("فقط فعال")}),unchecked:u((e,t,a,r)=>{if(!t)return[p("همه")];t("همه")}),_:1},a,r)),t("</div>")}),_:1},l)),r(v(o(A),{columns:H.value,data:N.value,loading:T.value,bordered:!1,class:"rounded-2xl ring-1 ring-slate-200 overflow-hidden"},null,l)),r(`<div class="mt-4 flex items-center justify-between"><div class="text-sm text-slate-600">تعداد کل: ${f(L.value)}</div><div class="flex items-center gap-2">`),r(v(o(x),{size:"small",disabled:0===S.value,onClick:prev},{default:u((e,t,a,r)=>{if(!t)return[p("قبلی")];t("قبلی")}),_:1},l)),r(v(o(x),{size:"small",disabled:S.value+B.value>=L.value,onClick:next},{default:u((e,t,a,r)=>{if(!t)return[p("بعدی")];t("بعدی")}),_:1},l)),r("</div></div></section>")}}}),U=C.setup;C.setup=(e,t)=>{const a=d();return(a.modules||(a.modules=new Set)).add("pages/admin/categories/index.vue"),U?U(e,t):void 0};export{C as default};
//# sourceMappingURL=index-DVlYJK_f.mjs.map
