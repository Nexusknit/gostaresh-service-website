import{_ as e}from"./nuxt-link-DlD_4d-2.mjs";import{defineComponent as a,computed as l,ref as r,mergeProps as t,withCtx as i,createTextVNode as s,unref as o,createVNode as u,createBlock as n,createCommentVNode as d,openBlock as m,useSSRContext as p}from"vue";import{ssrRenderAttrs as v,ssrRenderComponent as c}from"vue/server-renderer";import{useRoute as f}from"vue-router";import{a as y,b}from"./api-qvnChiK5.mjs";import{u as g}from"./useAccess-BGBQvVbm.mjs";import{N as h,C as _,F as x}from"./server.mjs";import{u as k}from"./use-message-DH0YWJK4.mjs";import{N as j,a as C}from"./FormItem-Ds_MAETL.mjs";import{N as U}from"./Input-DBNoyZOz.mjs";import{N as w}from"./Select-C0U9uRTf.mjs";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:url";import"@iconify/utils";import"node:crypto";import"consola";import"node:path";import"./useAuth-BCA76F4T.mjs";import"pinia";import"@iconify/vue";import"@css-render/vue3-ssr";import"seemly";import"@css-render/plugin-bem";import"css-render";import"lodash-es";import"evtd";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/plugins";import"unhead/utils";import"async-validator";import"date-fns/locale";import"treemate";import"./Tag-BJGgCXYj.mjs";import"@juggle/resize-observer";const D=a({__name:"[id]",__ssrInlineRender:!0,setup(a){const{hasPerm:p}=g(),D=l(()=>p("role.update")),S=l(()=>p("role.delete")),$=l(()=>p("role_permission.update")),B=l(()=>p("permission.read")),N=l(()=>$.value||B.value),A=f(),I=String(A.params.id),P=k(),R=r(null),T=r({name:""}),F={name:{required:!0,message:"نام الزامی است",trigger:"blur"}},q=r(!1),z=r(!1),G=r([]),J=r([]),K=r(!1);async function onSubmit(){if(D.value){try{await(R.value?.validate())}catch{return}q.value=!0;try{await y(`/roles/${I}`,{name:T.value.name}),P.success("ذخیره شد")}catch(e){P.error(e?.data?.message||"ذخیره انجام نشد")}finally{q.value=!1}}}async function onDelete(){if(S.value&&confirm("حذف نقش؟")){z.value=!0;try{await b(`/roles/${I}`),P.success("حذف شد"),x("/admin/roles")}catch(e){P.error(e?.data?.message||"حذف انجام نشد")}finally{z.value=!1}}}const Y=l(()=>G.value.map(e=>({label:e.name||e.id,value:String(e.id)})));async function savePermissions(){if($.value){K.value=!0;try{await y(`/roles/${I}/permissions`,{permissionIDs:J.value}),P.success("مجوزها ذخیره شد")}catch(e){P.error(e?.data?.message||"ذخیره مجوزها انجام نشد")}finally{K.value=!1}}}return(a,l,r,p)=>{const f=e;l(`<section${v(t({class:"container mx-auto px-4 py-8",dir:"rtl"},p))}><div class="mb-5 flex items-center justify-between gap-3"><h1 class="text-xl font-bold">ویرایش نقش</h1>`),l(c(f,{to:"/admin/roles",class:"text-sky-600 hover:underline text-sm"},{default:i((e,a,l,r)=>{if(!a)return[s("بازگشت")];a("بازگشت")}),_:1},r)),l("</div>"),l(c(o(h),{class:"rounded-2xl ring-1 ring-slate-200/80 shadow-sm mb-6",bordered:!1},{default:i((e,a,l,r)=>{if(!a)return[u(o(j),{model:T.value,rules:F,ref_key:"formRef",ref:R,"label-placement":"left","label-width":"140"},{default:i(()=>[u(o(C),{label:"نام",path:"name"},{default:i(()=>[u(o(U),{value:T.value.name,"onUpdate:value":e=>T.value.name=e,disabled:!D.value},null,8,["value","onUpdate:value","disabled"])]),_:1}),u("div",{class:"pt-2 flex items-center gap-2"},[D.value?(m(),n(o(_),{key:0,type:"primary",loading:q.value,onClick:onSubmit},{default:i(()=>[s("ذخیره")]),_:1},8,["loading"])):d("",!0),S.value?(m(),n(o(_),{key:1,type:"error",secondary:"",loading:z.value,onClick:onDelete},{default:i(()=>[s("حذف")]),_:1},8,["loading"])):d("",!0)])]),_:1},8,["model"])];a(c(o(j),{model:T.value,rules:F,ref_key:"formRef",ref:R,"label-placement":"left","label-width":"140"},{default:i((e,a,l,r)=>{if(!a)return[u(o(C),{label:"نام",path:"name"},{default:i(()=>[u(o(U),{value:T.value.name,"onUpdate:value":e=>T.value.name=e,disabled:!D.value},null,8,["value","onUpdate:value","disabled"])]),_:1}),u("div",{class:"pt-2 flex items-center gap-2"},[D.value?(m(),n(o(_),{key:0,type:"primary",loading:q.value,onClick:onSubmit},{default:i(()=>[s("ذخیره")]),_:1},8,["loading"])):d("",!0),S.value?(m(),n(o(_),{key:1,type:"error",secondary:"",loading:z.value,onClick:onDelete},{default:i(()=>[s("حذف")]),_:1},8,["loading"])):d("",!0)])];a(c(o(C),{label:"نام",path:"name"},{default:i((e,a,l,r)=>{if(!a)return[u(o(U),{value:T.value.name,"onUpdate:value":e=>T.value.name=e,disabled:!D.value},null,8,["value","onUpdate:value","disabled"])];a(c(o(U),{value:T.value.name,"onUpdate:value":e=>T.value.name=e,disabled:!D.value},null,l,r))}),_:1},l,r)),a(`<div class="pt-2 flex items-center gap-2"${r}>`),D.value?a(c(o(_),{type:"primary",loading:q.value,onClick:onSubmit},{default:i((e,a,l,r)=>{if(!a)return[s("ذخیره")];a("ذخیره")}),_:1},l,r)):a("\x3c!----\x3e"),S.value?a(c(o(_),{type:"error",secondary:"",loading:z.value,onClick:onDelete},{default:i((e,a,l,r)=>{if(!a)return[s("حذف")];a("حذف")}),_:1},l,r)):a("\x3c!----\x3e"),a("</div>")}),_:1},l,r))}),_:1},r)),N.value?l(c(o(h),{class:"rounded-2xl ring-1 ring-slate-200/80 shadow-sm",bordered:!1},{header:i((e,a,l,r)=>{if(!a)return[s("مجوزهای نقش")];a("مجوزهای نقش")}),default:i((e,a,l,r)=>{if(!a)return[u("div",{class:"space-y-3"},[u(o(w),{value:J.value,"onUpdate:value":e=>J.value=e,options:Y.value,disabled:!$.value,multiple:"",filterable:"",placeholder:"انتخاب مجوز"},null,8,["value","onUpdate:value","options","disabled"]),u("div",null,[u(o(_),{type:"primary",loading:K.value,disabled:!$.value,onClick:savePermissions},{default:i(()=>[s(" ذخیره مجوزها ")]),_:1},8,["loading","disabled"])])])];a(`<div class="space-y-3"${r}>`),a(c(o(w),{value:J.value,"onUpdate:value":e=>J.value=e,options:Y.value,disabled:!$.value,multiple:"",filterable:"",placeholder:"انتخاب مجوز"},null,l,r)),a(`<div${r}>`),a(c(o(_),{type:"primary",loading:K.value,disabled:!$.value,onClick:savePermissions},{default:i((e,a,l,r)=>{if(!a)return[s(" ذخیره مجوزها ")];a(" ذخیره مجوزها ")}),_:1},l,r)),a("</div></div>")}),_:1},r)):l("\x3c!----\x3e"),l("</section>")}}}),S=D.setup;D.setup=(e,a)=>{const l=p();return(l.modules||(l.modules=new Set)).add("pages/admin/roles/[id].vue"),S?S(e,a):void 0};export{D as default};
//# sourceMappingURL=_id_-CE-3ij5M.mjs.map
