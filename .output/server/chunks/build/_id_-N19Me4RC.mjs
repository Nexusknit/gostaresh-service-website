import{_ as e}from"./nuxt-link-DlD_4d-2.mjs";import{defineComponent as l,ref as a,computed as t,mergeProps as u,withCtx as n,createTextVNode as o,unref as r,createVNode as i,useSSRContext as v}from"vue";import{ssrRenderAttrs as s,ssrRenderComponent as p}from"vue/server-renderer";import{useRoute as d}from"vue-router";import{a as m,b as c}from"./api-qvnChiK5.mjs";import{N as f,C as g,F as y}from"./server.mjs";import{u as h}from"./use-message-DH0YWJK4.mjs";import{N as b,a as U}from"./FormItem-Ds_MAETL.mjs";import{N as C}from"./Input-DBNoyZOz.mjs";import{N as _}from"./Select-C0U9uRTf.mjs";import{N as D}from"./Switch-DTUH-ntq.mjs";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:url";import"@iconify/utils";import"node:crypto";import"consola";import"node:path";import"pinia";import"@iconify/vue";import"@css-render/vue3-ssr";import"seemly";import"@css-render/plugin-bem";import"css-render";import"lodash-es";import"evtd";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/plugins";import"unhead/utils";import"async-validator";import"date-fns/locale";import"treemate";import"./Tag-BJGgCXYj.mjs";import"@juggle/resize-observer";const x=l({__name:"[id]",__ssrInlineRender:!0,setup(l){const v=d(),x=String(v.params.id),T=h(),I=a(null),j=a({title:"",slug:"",articleTypeID:"",shortContent:"",longContent:"",isActive:!0}),S=a([]),A=a(!1),w=a(!1),k=t(()=>S.value.map(e=>({label:e.name||e.id,value:e.id}))),B={title:{required:!0,message:"عنوان الزامی است",trigger:"blur"}};async function ensureSlug(){if(j.value.title&&!j.value.slug)try{const{slug:e}=await $apiFetch("/utils/slug/preview",{method:"POST",body:{model:"article",source:j.value.title,excludeId:x}});e&&(j.value.slug=e)}catch{}}async function onSubmit(){try{await(I.value?.validate())}catch{return}A.value=!0;try{await m(`/articles/${x}`,{title:j.value.title,articleTypeID:j.value.articleTypeID||void 0,shortContent:j.value.shortContent||void 0,longContent:j.value.longContent||void 0,slug:j.value.slug||void 0,isActive:j.value.isActive}),T.success("ذخیره شد")}catch(e){T.error(e?.data?.message||"خطا در ذخیره")}finally{A.value=!1}}async function onDelete(){if(confirm("حذف مقاله؟")){w.value=!0;try{await c(`/articles/${x}`),y("/admin/articles")}catch(e){T.error(e?.data?.message||"خطا در حذف")}finally{w.value=!1}}}return(l,a,t,v)=>{const d=e;a(`<section${s(u({class:"container mx-auto px-4 py-8",dir:"rtl"},v))}><div class="mb-5 flex items-center justify-between gap-3"><h1 class="text-xl font-bold">ویرایش مقاله</h1>`),a(p(d,{to:"/admin/articles",class:"text-sky-600 hover:underline text-sm"},{default:n((e,l,a,t)=>{if(!l)return[o("بازگشت")];l("بازگشت")}),_:1},t)),a("</div>"),a(p(r(f),{class:"rounded-2xl ring-1 ring-slate-200/80 shadow-sm",bordered:!1},{default:n((e,l,a,t)=>{if(!l)return[i(r(b),{model:j.value,rules:B,ref_key:"formRef",ref:I,"label-placement":"left","label-width":"140"},{default:n(()=>[i(r(U),{label:"عنوان",path:"title"},{default:n(()=>[i(r(C),{value:j.value.title,"onUpdate:value":e=>j.value.title=e,onBlur:ensureSlug},null,8,["value","onUpdate:value"])]),_:1}),i(r(U),{label:"اسلاگ",path:"slug"},{default:n(()=>[i(r(C),{value:j.value.slug,"onUpdate:value":e=>j.value.slug=e},null,8,["value","onUpdate:value"])]),_:1}),i(r(U),{label:"نوع",path:"articleTypeID"},{default:n(()=>[i(r(_),{value:j.value.articleTypeID,"onUpdate:value":e=>j.value.articleTypeID=e,options:k.value,filterable:"",clearable:""},null,8,["value","onUpdate:value","options"])]),_:1}),i(r(U),{label:"خلاصه",path:"shortContent"},{default:n(()=>[i(r(C),{value:j.value.shortContent,"onUpdate:value":e=>j.value.shortContent=e,type:"textarea"},null,8,["value","onUpdate:value"])]),_:1}),i(r(U),{label:"متن کامل",path:"longContent"},{default:n(()=>[i(r(C),{value:j.value.longContent,"onUpdate:value":e=>j.value.longContent=e,type:"textarea"},null,8,["value","onUpdate:value"])]),_:1}),i(r(U),{label:"فعال"},{default:n(()=>[i(r(D),{value:j.value.isActive,"onUpdate:value":e=>j.value.isActive=e},null,8,["value","onUpdate:value"])]),_:1}),i("div",{class:"pt-2 flex items-center gap-2"},[i(r(g),{type:"primary",loading:A.value,onClick:onSubmit},{default:n(()=>[o("ذخیره")]),_:1},8,["loading"]),i(r(g),{type:"error",secondary:"",loading:w.value,onClick:onDelete},{default:n(()=>[o("حذف")]),_:1},8,["loading"])])]),_:1},8,["model"])];l(p(r(b),{model:j.value,rules:B,ref_key:"formRef",ref:I,"label-placement":"left","label-width":"140"},{default:n((e,l,a,t)=>{if(!l)return[i(r(U),{label:"عنوان",path:"title"},{default:n(()=>[i(r(C),{value:j.value.title,"onUpdate:value":e=>j.value.title=e,onBlur:ensureSlug},null,8,["value","onUpdate:value"])]),_:1}),i(r(U),{label:"اسلاگ",path:"slug"},{default:n(()=>[i(r(C),{value:j.value.slug,"onUpdate:value":e=>j.value.slug=e},null,8,["value","onUpdate:value"])]),_:1}),i(r(U),{label:"نوع",path:"articleTypeID"},{default:n(()=>[i(r(_),{value:j.value.articleTypeID,"onUpdate:value":e=>j.value.articleTypeID=e,options:k.value,filterable:"",clearable:""},null,8,["value","onUpdate:value","options"])]),_:1}),i(r(U),{label:"خلاصه",path:"shortContent"},{default:n(()=>[i(r(C),{value:j.value.shortContent,"onUpdate:value":e=>j.value.shortContent=e,type:"textarea"},null,8,["value","onUpdate:value"])]),_:1}),i(r(U),{label:"متن کامل",path:"longContent"},{default:n(()=>[i(r(C),{value:j.value.longContent,"onUpdate:value":e=>j.value.longContent=e,type:"textarea"},null,8,["value","onUpdate:value"])]),_:1}),i(r(U),{label:"فعال"},{default:n(()=>[i(r(D),{value:j.value.isActive,"onUpdate:value":e=>j.value.isActive=e},null,8,["value","onUpdate:value"])]),_:1}),i("div",{class:"pt-2 flex items-center gap-2"},[i(r(g),{type:"primary",loading:A.value,onClick:onSubmit},{default:n(()=>[o("ذخیره")]),_:1},8,["loading"]),i(r(g),{type:"error",secondary:"",loading:w.value,onClick:onDelete},{default:n(()=>[o("حذف")]),_:1},8,["loading"])])];l(p(r(U),{label:"عنوان",path:"title"},{default:n((e,l,a,t)=>{if(!l)return[i(r(C),{value:j.value.title,"onUpdate:value":e=>j.value.title=e,onBlur:ensureSlug},null,8,["value","onUpdate:value"])];l(p(r(C),{value:j.value.title,"onUpdate:value":e=>j.value.title=e,onBlur:ensureSlug},null,a,t))}),_:1},a,t)),l(p(r(U),{label:"اسلاگ",path:"slug"},{default:n((e,l,a,t)=>{if(!l)return[i(r(C),{value:j.value.slug,"onUpdate:value":e=>j.value.slug=e},null,8,["value","onUpdate:value"])];l(p(r(C),{value:j.value.slug,"onUpdate:value":e=>j.value.slug=e},null,a,t))}),_:1},a,t)),l(p(r(U),{label:"نوع",path:"articleTypeID"},{default:n((e,l,a,t)=>{if(!l)return[i(r(_),{value:j.value.articleTypeID,"onUpdate:value":e=>j.value.articleTypeID=e,options:k.value,filterable:"",clearable:""},null,8,["value","onUpdate:value","options"])];l(p(r(_),{value:j.value.articleTypeID,"onUpdate:value":e=>j.value.articleTypeID=e,options:k.value,filterable:"",clearable:""},null,a,t))}),_:1},a,t)),l(p(r(U),{label:"خلاصه",path:"shortContent"},{default:n((e,l,a,t)=>{if(!l)return[i(r(C),{value:j.value.shortContent,"onUpdate:value":e=>j.value.shortContent=e,type:"textarea"},null,8,["value","onUpdate:value"])];l(p(r(C),{value:j.value.shortContent,"onUpdate:value":e=>j.value.shortContent=e,type:"textarea"},null,a,t))}),_:1},a,t)),l(p(r(U),{label:"متن کامل",path:"longContent"},{default:n((e,l,a,t)=>{if(!l)return[i(r(C),{value:j.value.longContent,"onUpdate:value":e=>j.value.longContent=e,type:"textarea"},null,8,["value","onUpdate:value"])];l(p(r(C),{value:j.value.longContent,"onUpdate:value":e=>j.value.longContent=e,type:"textarea"},null,a,t))}),_:1},a,t)),l(p(r(U),{label:"فعال"},{default:n((e,l,a,t)=>{if(!l)return[i(r(D),{value:j.value.isActive,"onUpdate:value":e=>j.value.isActive=e},null,8,["value","onUpdate:value"])];l(p(r(D),{value:j.value.isActive,"onUpdate:value":e=>j.value.isActive=e},null,a,t))}),_:1},a,t)),l(`<div class="pt-2 flex items-center gap-2"${t}>`),l(p(r(g),{type:"primary",loading:A.value,onClick:onSubmit},{default:n((e,l,a,t)=>{if(!l)return[o("ذخیره")];l("ذخیره")}),_:1},a,t)),l(p(r(g),{type:"error",secondary:"",loading:w.value,onClick:onDelete},{default:n((e,l,a,t)=>{if(!l)return[o("حذف")];l("حذف")}),_:1},a,t)),l("</div>")}),_:1},a,t))}),_:1},t)),a("</section>")}}}),T=x.setup;x.setup=(e,l)=>{const a=v();return(a.modules||(a.modules=new Set)).add("pages/admin/articles/[id].vue"),T?T(e,l):void 0};export{x as default};
//# sourceMappingURL=_id_-N19Me4RC.mjs.map
