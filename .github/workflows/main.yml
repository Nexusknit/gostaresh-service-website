name: SSH Smoke Test (Password)
on:
  workflow_dispatch:

jobs:
  smoke:
    runs-on: ubuntu-latest
    steps:
      - name: Show runner public IP
        run: |
          echo "Runner public IP:"
          curl -s https://api.ipify.org || true
          echo

      - name: SSH into server (password)
        uses: appleboy/ssh-action@v1
        with:
          host: ${{ secrets.DEPLOY_HOST }}
          username: ${{ secrets.DEPLOY_USER }}
          password: ${{ secrets.DEPLOY_PASSWORD }}
          port: ${{ secrets.DEPLOY_PORT }}
          script: |
            echo "SSH_OK"
            whoami
            hostname
            date
            mkdir -p /home/${{ secrets.DEPLOY_USER }}/repositories/frontend/.deploy_test
            echo "from github actions $(date)" > /home/${{ secrets.DEPLOY_USER }}/repositories/frontend/.deploy_test/from_actions.txt
